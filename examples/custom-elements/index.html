<!doctype html>
<html>
<head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
  <title>Custom elements</title>
</head>
<body>
    <script type="text/javascript">

    // Create a function that that formats text as you need. Here we have
    // a function to localize dates:
    //
    //   localizeDate('sr-RS', 12, 5) == "петак, 1. јун 2012."
    //   localizeDate('en-GB', 12, 5) == "Friday, 1 June 2012"
    //   localizeDate('en-US', 12, 5) == "Friday, June 1, 2012"
    //
    function localizeDate(lang, year, month)
    {
        const dateTimeFormat = new Intl.DateTimeFormat(lang, {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });

        return dateTimeFormat.format(new Date(year, month));
    }

    // Define a Custom Element that uses this function. Here we make it
    // possible to define nodes like this:
    //
    //     <intl-date lang="sr-RS" year="2012" month="5">
    //     <intl-date lang="en-GB" year="2012" month="5">
    //     <intl-date lang="en-US" year="2012" month="5">
    //
    // Check out src/lib.rs to see how you use this on the rust side.
    //
    customElements.define('intl-date',
        class IntlDate extends HTMLElement {
            // things required by Custom Elements
            constructor() { 
                super(); 
                this.some_props = "I'm now set";
            }
            connectedCallback() { this.setTextContent(); }
            attributeChangedCallback() { this.setTextContent(); }
            static get observedAttributes() { return ['lang','year','month']; }

            // Our function to set the textContent based on attributes.
            setTextContent()
            {
                console.log("some props: {}", this.some_props);

                const lang = this.getAttribute('lang');
                const year = this.getAttribute('year');
                const month = this.getAttribute('month');
                //this.textContent = localizeDate(lang, year, month);
                let text = document.createTextNode(localizeDate(lang, year, month));
                while (this.hasChildNodes()) {
                  this.removeChild(this.firstChild);
                }
                this.appendChild(text);
            }
        }
    );
        function changeLanguage(){
            console.log("changing the language..");
            let elm =  document.getElementById("id1");
            elm.setAttribute("lang", "us-US");
        }

    </script>
    <script type=module>
        import init, { AppCE } from './pkg/custom_elements.js';
        await init().catch(console.error);

        function defineCustomElement(custom_tag){
            customElements.define(custom_tag,
                class extends HTMLElement{
                    constructor(){
                        super();
                        console.log("this: {}", this);
                        this.instance = new AppCE(this);
                    }
                    
                    static get observedAttributes(){
                        console.log("called observedAttributes");
                        let attrs = AppCE.observed_attributes();
                        console.log("attrs:", attrs);
                        return attrs;
                    }

                    connectedCallback(){
                        this.instance.connected_callback();
                    }
                    disconnectedCallback(){
                        this.instance.disconnected_callback();
                    }
                    adoptedCallback(){
                        this.instance.adopted_callback();
                    }
                    attributeChangedCallback(){
                        this.instance.attribute_changed_callback();
                    }

                }
            );
        }

        defineCustomElement('local-date');

    </script>
    <local-date id="id1" lang="ph" year="2022" month="12"></local-date>
    <button onclick="changeLanguage()">Change language</button>
</body>
</html>
